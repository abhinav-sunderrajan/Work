library(RPostgreSQL)
library(ggplot2)
require(gridExtra)
library(rgl)
library("reshape2")
library("plot3D")

drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, host='172.25.187.111', port='5432', dbname='abhinav',
                 user='abhinav', password='qwert$$123')


countMapList <- vector("list", length = 12)
countMapAccidentList<-vector("list", length = 3)


iterAcc=1
iterNoAcc=1

light=c( 2, 5, 7, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21)
medium=c(1, 4, 8, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33)
heavy<-c(3, 6, 9, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45)

distBreaks=c(  0.0, 30.55, 53.56, 171.72, 286.62, 397.95, 429.11, 509.39, 547.24, 623.72,
               745.24, 811.16, 864.9, 993.93, 1009.92, 1024.93, 1054.09, 1183.39, 1198.11, 1358.5,
               1495.85, 1661.73, 1777.87, 1839.59, 1998.83, 2087.22, 2105.1, 2265.36, 2304.79,
               2318.51, 2409.81, 2445.73, 2603.75, 2720.89, 2736.28, 2857.98, 2908.65, 2968.26,
               3030.72, 3131.71, 3178.87, 3292.7, 3408.92, 3499.32, 3532.65, 3650.71, 3775.36,
               3893.53, 3916.69, 4150.08, 4168.92, 4255.44, 4392.65, 4408.88, 4532.84, 4644.54,
               4666.99, 4684.43, 4903.53, 5056.2, 5074.29, 5295.43, 5354.94, 5413.93, 5526.54,
               5539.85, 5626.36, 5655.3, 5770.73, 5886.31, 6005.03, 6119.88, 6233.74, 6317.37,
               6354.99, 6474.52, 6600.5, 6729.36, 6962.05, 7073.54, 7184.9, 7296.22, 7407.51,
               7519.06, 7630.37, 7742.35, 7853.99, 7965.53, 8077.42, 8189.15, 8300.91, 8390.45,
               8412.58, 8482.05, 8528.01, 8613.22, 8758.9, 8862.8, 8878.78, 8973.22, 8994.24,
               9220.9, 9338.89, 9428.88, 9468.61, 9497.85, 9585.44, 9684.11, 9700.66, 9820.9,
               9925.41, 9952.8, 10059.39, 10104.38, 10227.4, 10274.71, 10285.92, 10416.55,
               10429.98, 10443.2, 10589.77, 10604.43, 10666.54, 10734.86, 10748.23, 10767.35,
               10819.28, 10920.93, 11107.99, 11219.71, 11239.34, 11333.11, 11386.08, 11448.4,
               11516.83, 11566.9, 11595.85, 11690.37, 11810.26, 11928.98, 12045.64, 12092.9,
               12158.48, 12192.09, 12269.83, 12381.24, 12493.49, 12589.47, 12606.95, 12689.53,
               12722.25, 12836.62, 12951.13 )

distLabels=c(  0.0, 30.55, 53.56, 171.72, 286.62, 397.95, 429.11, 509.39, 547.24, 623.72,
               745.24, 811.16, 864.9, 993.93, 1009.92, 1024.93, 1054.09, 1183.39, 1198.11, 1358.5,
               1495.85, 1661.73, 1777.87, 1839.59, 1998.83, 2087.22, 2105.1, 2265.36, 2304.79,
               2318.51, 2409.81, 2445.73, 2603.75, 2720.89, 2736.28, 2857.98, 2908.65, 2968.26,
               3030.72, 3131.71, 3178.87, 3292.7, 3408.92, 3499.32, 3532.65, 3650.71, 3775.36,
               3893.53, 3916.69, 4150.08, 4168.92, 4255.44, 4392.65, 4408.88, 4532.84, 4644.54,
               4666.99, 4684.43, 4903.53, 5056.2, 5074.29, 5295.43, 5354.94, 5413.93, 5526.54,
               5539.85, 5626.36, 5655.3, 5770.73, 5886.31, 6005.03, 6119.88, 6233.74, 6317.37,
               6354.99, 6474.52, 6600.5, 6729.36, 6962.05, 7073.54, 7184.9, 7296.22, 7407.51,
               7519.06, 7630.37, 7742.35, 7853.99, 7965.53, 8077.42, 8189.15, 8300.91, 8390.45,
               8412.58, 8482.05, 8528.01, 8613.22, 8758.9, 8862.8, 8878.78, 8973.22, 8994.24,
               9220.9, 9338.89, 9428.88, 9468.61, 9497.85, 9585.44, 9684.11, 9700.66, 9820.9,
               9925.41, 9952.8, 10059.39, 10104.38, 10227.4, 10274.71, 10285.92, 10416.55,
               10429.98, 10443.2, 10589.77, 10604.43, 10666.54, 10734.86, 10748.23, 10767.35,
               10819.28, 10920.93, 11107.99, 11219.71, 11239.34, 11333.11, 11386.08, 11448.4,
               11516.83, 11566.9, 11595.85, 11690.37, 11810.26, 11928.98, 12045.64, 12092.9,
               12158.48, 12192.09, 12269.83, 12381.24, 12493.49, 12589.47, 12606.95, 12689.53,
               12722.25, 12836.62)
iter1<-c(47)

pieBreaks<-c(0.0,583.9831796057117, 1973.3525390927846, 2367.5948374569775, 2489.872751163762, 3261.271616457807, 4071.903598144841, 4834.836586015808, 5531.1844928841365, 5743.1141418953775, 5965.289275894134, 6207.740716730275, 6670.222224060167, 7025.154292404613, 7658.39571005447, 8040.834612543026, 8554.283981491059, 8807.936731242416, 9591.841494223643, 10148.238120947959, 11286.20075545962, 11637.04476230792, 12438.227750939186, 13328.802132638793)
pieLabels<-c(0.0,583.9831796057117, 1973.3525390927846, 2367.5948374569775, 2489.872751163762, 3261.271616457807, 4071.903598144841, 4834.836586015808, 5531.1844928841365, 5743.1141418953775, 5965.289275894134, 6207.740716730275, 6670.222224060167, 7025.154292404613, 7658.39571005447, 8040.834612543026, 8554.283981491059, 8807.936731242416, 9591.841494223643, 10148.238120947959, 11286.20075545962, 11637.04476230792, 12438.227750939186)


for(iter in iter1){
  query<-paste("select time_stamp ,distance_along_road,speed,is_accident from semsim_output WHERE iteration_count="
               ,iter," AND time_stamp >=1000 AND time_stamp <1100 AND distance_along_road<=13000", sep="")
  data<-dbGetQuery(con,query)
  summary(data)
  
  c1<-cut(data$distance_along_road,breaks =  seq(0, 13000, by = 50),labels =  seq(0, 12950, by = 50))
  distance_split<-split(data,c1)
  
 
  index=1
  speeds=numeric()
  
  
  
  for(name_dist in names(distance_split)){
    y<-distance_split[[name_dist]]
    mean_speed=mean(y$speed)
    se=sum((y$speed-mean_speed)*(y$speed-mean_speed))
    speeds[index]=se
    index<-index+1 
    
  }
}
  
  
  
  




sum(speeds)



#Close Database connection
dbDisconnect(con)




